{% load static %}

{% url 'account_login' as login_url %}
{% url 'account_signup' as signup_url %}
{% url 'account_logout' as logout_url %}

<!doctype html>
<html lang="en">

<head>
    {% block meta %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Meta tags for search engines -->
    <meta name="description"
        content="Discover CozyNest - your cozy destination for soft cotton bedding, queen duvet covers, decorative pillow covers, toddler bedding sets, warm blankets, cozy cotton pajamas and stylish cozy bedroom decor.">
    <meta name="keywords"
        content="cozy bedding, single bed bedding, cotton queen size duvet covers, zipper duvet covers, soft sheets, fitted sheets, breathable bed sheets, toddler bedding sets, cartoon bedding, dinosaur bedding for kids, cotton pillowcases, decorative pillow covers, warm blankets, cozy cotton pajamas, silk pajamas, stylish bedroom decor">
    {% endblock %}

    {% block corecss %}
    <!-- favicons generated by favicon.io -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon_io/apple-touch-icon.png'%}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon_io/favicon-32x32.png'%}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon_io/favicon-16x16.png'%}">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- Mailchimp CSS -->
    <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/base.css'%}">
    {% endblock %}

    {% block extra_css %}
    {% endblock %}

    <title>CozyNest {% block extra_title %}{% endblock %}</title>
</head>

<body>
    <header>
        <!-- Top navbar -->
        <nav class="navbar navbar-expand-md bg-light px-0 px-lg-3 position-relative">
            <div class="container-fluid">
                <a class="navbar-brand" href="{% url 'home' %}">CozyNest ðŸª¶</a>

                <!-- Desktop navbar -->
                <form id="desktop-search-form" action="{% url 'products' %}" class="d-none d-md-flex navbar-center-md"
                    role="search" style="width: 300px;">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="text" name="q" class="form-control rounded-0 search-input" placeholder="Search..."
                            aria-label="Search" aria-describedby="search-addon">
                        <div class="input-group-append">
                            <button class="form-control btn btn-dark rounded-0 " type="submit">
                                <span class="input-group-text rounded-0 search-span text-bg-dark" id="search-addon">
                                    <i class="fa-solid fa-search"></i>
                                </span>
                            </button>
                        </div>
                    </div>
                </form>

                <ul class="navbar-nav d-none d-md-flex ms-auto align-items-center gap-3">
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'view_bag' %}">
                            <div class="text-center">
                                <div><i class="fa-solid fa-shopping-bag"></i></div>
                                <p class="my-0">
                                    {% if total_quantity %}
                                    {{ total_quantity }}
                                    {% else %}
                                    No items
                                    {% endif %}
                                </p>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <div class="text-center">
                                <div><i class="fas fa-user fa-lg"></i></div>
                                {% if user.is_authenticated %}
                                <p class="my-0">Hello, {{ user.username }}!</p>
                                {% else %}
                                <p class="my-0">My Account</p>
                                {% endif %}
                            </div>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-md-end">
                            {% include 'includes/account_dropdown.html' %}
                        </ul>
                    </li>
                </ul>

                <!-- Mobile navbar and subnavbar -->
                <div class="d-md-none d-flex align-items-center ms-auto gap-2 position-relative">
                    <!-- Search -->
                    <button class="icon-button" id="mobile-search-toggle" aria-label="Search">
                        <span class="icon"><i class="fa-solid fa-search"></i></span>
                    </button> 
                    <!-- Sopping bag -->
                    <a class="icon-link" href="{% url 'view_bag' %}">
                        <span class="icon"><i class="fa-solid fa-shopping-bag"></i></span>
                        <span>
                            {% if total_quantity %}
                                {{ total_quantity }}
                            {% endif %}
                        </span>
                    </a>
                    <!-- User account -->
                    <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse"
                        data-bs-target="#mobile-dropdown-menu" aria-controls="mobile-dropdown-menu"
                        aria-expanded="false" aria-label="Toggle navigation" id="burger-toggler">
                        <i class="fas fa-user fa-lg icon"></i></span>
                    </button>
                    <!-- Subnavbar burger toggle -->
                    <button class="navbar-toggler d-md-none border-0 p-0" type="button" data-bs-toggle="collapse"
                        data-bs-target="#mobile-subnavbar" aria-controls="mobile-subnavbar" aria-expanded="false"
                        aria-label="Toggle navigation">
                        <i class="fas fa-bars icon"></i>
                    </button>
                </div>

                <!-- Mobile account dropdown -->
                <div class="collapse navbar-collapse d-md-none" id="mobile-dropdown-menu">
                    <ul class="mobile-dropdown-menu dropdown-menu-end">
                        {% include 'includes/account_dropdown.html' %}
                    </ul>
                </div>
            </div>

            <!-- Mobile search input -->
            <div class="container-fluid px-3 d-md-none" id="mobile-search-section">
                <form action="{% url 'products' %}" role="search">
                    <input id="mobile-search-input" class="form-control" name="q" type="search" placeholder="Search..."
                        aria-label="Search" />
                </form>
            </div>
        </nav>

        <!-- Subnavbar -->
        <!-- Desktop subnavbar -->
        <nav class="navbar navbar-expand-md pt-0 d-none d-md-flex">
            <div class="container-fluid">
                <ul class="navbar-nav d-flex justify-content-center gap-3 w-100">
                    {% include 'includes/subnavbar.html' %}
                </ul>
            </div>
        </nav>

        <!-- Mobile subnavbar -->
        <div class="collapse d-md-none" id="mobile-subnavbar">
            <nav class="navbar pt-0">
                <div class="container-fluid">
                    <ul class="navbar-nav d-flex flex-column w-100">
                        {% include 'includes/subnavbar.html' %}
                    </ul>
                </div>
            </nav>
        </div>
        <div class="container-fluid">
            <div id="delivery-banner" class="row text-center">
                <div class="col bg-black text-white">
                    <p class="fs-6 my-1">Free delivery on orders over â‚¬{{ free_delivery_threshold }}</p>
                </div>
            </div>
        </div>
    </header>

    {% if messages %}
    <div class="message-container">
        {% for message in messages %}
        {% with message.level as level %}
        {% if level == 40 %}
        {% include 'includes/toasts/toast_error.html' %}
        {% elif level == 30 %}
        {% include 'includes/toasts/toast_warning.html' %}
        {% elif level == 25 %}
        {% include 'includes/toasts/toast_success.html' %}
        {% else %}
        {% include 'includes/toasts/toast_info.html' %}
        {% endif %}
        {% endwith %}
        {% endfor %}
    </div>
    {% endif %}

    {% block content %}
    {% endblock %}

    {% block footer %}
    {% endblock %}

    {% block corejs %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    {% endblock %}

    {% block postloadjs %}
    <script>
        document.getElementById('mobile-search-toggle').addEventListener('click', function () {
            const input = document.getElementById('mobile-search-input');
            input.style.display = (input.style.display === 'block') ? 'none' : 'block';
            if (input.style.display === 'block') input.focus();
        });

        // Toasts
        const toastElList = document.querySelectorAll('.toast');
        toastElList.forEach(toastEl => {
            const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
            toast.show();
        });
    </script>
    {% endblock %}
</body>

</html>